// Generated by CoffeeScript 1.3.1
(function() {

  $(function() {
    var NOTE_OFF, NOTE_ON, design, keyboard, scene;
    scene = new Scene('#container');
    design = new PianoKeyboardDesign();
    keyboard = new PianoKeyboard(design);
    scene.add(keyboard.model);
    scene.animate(function() {
      return keyboard.update();
    });
    window.keyboard = keyboard;
    NOTE_OFF = 128;
    NOTE_ON = 144;
    return MIDI.loadPlugin(function() {
      var player;
      player = MIDI.Player;
      player.loadFile(MIDIFiles['014-Bach, JS - Minuet in G'], function(midifile) {
        var rain;
        player.start();
        rain = new NoteRain({
          midiData: MIDI.Player.data,
          pianoDesign: design
        });
        player.setAnimation({
          delay: 30,
          callback: function(data) {
            return rain.update(data.now * 1000);
          }
        });
        return scene.add(rain.model);
      });
      return player.addListener(function(data) {
        var message, note;
        note = data.note, message = data.message;
        if (message === NOTE_ON) {
          return keyboard.press(note);
        } else if (message === NOTE_OFF) {
          return keyboard.release(note);
        }
      });
    });
  });

}).call(this);
